# Auth XMCP Next.js

A Next.js 15 application that pairs [Clerk](https://clerk.com/) authentication with XMCP adapters to expose OAuth-protected MCP endpoints and machine-readable discovery metadata. The project ships with production-ready middleware, token verification, and Vercel deployment settings.

## Table of Contents
- [Getting Started](#getting-started)
- [Project Scripts](#project-scripts)
- [Project Structure](#project-structure)
- [Key Features](#key-features)
- [Technologies Used](#technologies-used)
- [Configuration](#configuration)
- [Usage](#usage)
- [Deployment](#deployment)
- [Contributing](#contributing)
- [License](#license)

## Getting Started
- **Clone**: `git clone https://github.com/uratmangun/auth-xmcp-nextjs.git`
- **Install dependencies**: `bun install`
- **Set environment variables**: copy `.env.example` to `.env.local` and fill in the values described in [Configuration](#configuration).

## Project Scripts
- **Start dev server**: `bun run dev`
- **Build for production**: `bun run build`
- **Start production server**: `bun run start`
- **Run lint checks**: `bun run lint`

## Project Structure
```
.
├── public/                   # Static assets used by the Next.js app
├── src/
│   ├── app/
│   │   ├── page.tsx          # Landing page content
│   │   ├── mcp/route.ts      # MCP handler protected by Clerk auth
│   │   └── .well-known/      # OAuth + OpenID discovery endpoints
│   ├── middleware.ts         # Global Clerk middleware configuration
│   ├── prompts/              # XMCP prompt definitions
│   ├── resources/            # XMCP resource resolvers
│   └── tools/                # XMCP tool implementations
├── xmcp.config.ts            # XMCP runtime configuration
├── package.json              # Scripts and dependency manifest
├── bun.lock                  # Bun lockfile (package manager resolution)
└── README.md
```

## Key Features
- **Clerk-secured MCP endpoints** via `src/app/mcp/route.ts`, using `verifyClerkToken()` to authenticate bearer tokens.
- **OAuth discovery metadata** served from `.well-known/` routes for authorization server, protected resource, and OpenID configuration.
- **Next.js middleware integration** with `src/middleware.ts` applying `clerkMiddleware()` across dynamic routes.
- **XMCP adapter support** driven by `xmcp.config.ts`, enabling XMCP dev/build workflows alongside Next.js.

## Technologies Used
- Next.js 15 (App Router, Turbopack dev server)
- React 19
- Clerk (`@clerk/nextjs`, `@clerk/mcp-tools`)
- XMCP adapter (`@xmcp/adapter`, configured via `xmcp.config.ts`)
- Bun (dependency management and script runner)
- TypeScript, ESLint, Tailwind CSS (PostCSS pipeline)

## Configuration
Create `.env.local` using the provided `.env.example` template and supply the required credentials:

```
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_live_...
CLERK_SECRET_KEY=sk_live_...
```

These keys power Clerk's client and server SDKs during development and production builds.

## Usage
1. **Local development**: `bun run dev`
   - Runs XMCP dev server alongside Next.js (`xmcp dev & next dev --turbopack`).
   - Visit `http://localhost:3000` for the app UI.
2. **MCP endpoint testing**: send authenticated requests to `http://localhost:3000/mcp` with a valid Clerk bearer token. The handler is defined in `src/app/mcp/route.ts`.
3. **Discovery metadata**: inspect `.well-known/` routes (e.g., `/.well-known/openid-configuration`) for OAuth/OpenID documents generated by the app.

## Deployment
- **Vercel**: The project is configured for Vercel (`bun run build` runs `xmcp build && next build`).
- **Environment**: Set `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` and `CLERK_SECRET_KEY` in the Vercel production environment (`vc env add ...`).
- **Trigger production deploy**: `vc deploy --prod`.

## Contributing
Pull requests and issues are welcome. Please open a ticket describing proposed changes before submitting large contributions.

## License
No license has been specified yet. Add one (e.g., `LICENSE`) if you plan to distribute or open-source modifications.
